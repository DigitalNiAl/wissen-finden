<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Wissen greifbar machen</title>
<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    background: black;
    overflow: hidden;
}

video, canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
}

video {
    transform: scaleX(-1);
    opacity: 0.35;
    z-index: 1;
}

canvas {
    z-index: 2;
    pointer-events: none;
}
</style>
</head>

<body>
<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>

<!-- MediaPipe -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// MediaPipe Hands
const hands = new Hands({
  locateFile: file =>
    `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
});

hands.setOptions({
  maxNumHands: 1,
  modelComplexity: 1,
  minDetectionConfidence: 0.7,
  minTrackingConfidence: 0.7
});

let wordX = canvas.width / 2;
let wordY = canvas.height / 2;

hands.onResults(results => {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
    const hand = results.multiHandLandmarks[0];
    const point = hand[9]; // Mittelfinger-Basis

    wordX = point.x * canvas.width;
    wordY = point.y * canvas.height;
  }

  ctx.fillStyle = "white";
  ctx.font = "bold 80px Arial";
  ctx.fillText("WISSEN", wordX - 120, wordY - 40);
});

// Kamera starten
const camera = new Camera(video, {
  onFrame: async () => {
    await hands.send({ image: video });
  },
  width: 1280,
  height: 720
});

camera.start();
</script>
</body>
</html>
<script>
async function main() {
    await setupCamera();
    video.play();

    // Warten bis Video wirklich Daten hat
    await new Promise(resolve => {
        const check = () => {
            if (video.videoWidth > 0 && video.videoHeight > 0) {
                resolve();
            } else {
                requestAnimationFrame(check);
            }
        };
        check();
    });

    // Canvas jetzt korrekt setzen
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const model = await handpose.load();
    console.log("Handpose stabil geladen");

    let wordX = canvas.width / 2;
    let wordY = canvas.height / 2;

    async function render() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const predictions = await model.estimateHands(video);
        if (predictions.length > 0) {
            const [x, y] = predictions[0].landmarks[9];

            const scaleX = canvas.width / video.videoWidth;
            const scaleY = canvas.height / video.videoHeight;

            wordX = x * scaleX;
            wordY = y * scaleY;
        }

        ctx.fillStyle = "white";
        ctx.font = "bold 80px Arial";
        ctx.fillText("WISSEN", wordX - 100, wordY - 40);

        requestAnimationFrame(render);
    }

    render();
}

main();
</script>
